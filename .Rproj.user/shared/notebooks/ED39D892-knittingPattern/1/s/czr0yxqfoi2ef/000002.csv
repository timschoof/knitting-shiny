"0","# load data from https://ourworldindata.org/maternal-mortality"
"0","data <- owid(""number-of-maternal-deaths-by-region"")"
"0",""
"0","# compute number of maternal deaths per minute in the world"
"0","d <- data %>%"
"0","  clean_names() %>%"
"0","  filter(code == ""OWID_WRL"","
"0","         year == max(year)) %>%"
"0","  mutate(event_per_min = number_of_maternal_deaths/525960) # 525960 minutes per year"
"0",""
"0","# set bobble frequency to number of maternal deaths per minute in the world"
"0","event_per_min = d$event_per_min"
"0",""
"0","# some basic computations"
"0","tot_bobble_rows = nrows - nknit_start - nknit_end"
"0","bobble_freq =  round(stitch_rate / event_per_min)"
"0","total_stitches = nstitches * nrows"
"0",""
"0","# determine stitch location of bobbles "
"0","for (i in 1:tot_bobble_rows) {"
"0","  if (i == 1) {"
"0","    x_add = seq(from = first_bobble, to = nstitches, by = bobble_freq)"
"0","    x = x_add"
"0","    bobbles_row = length(x)"
"0","    y = rep(i+nknit_start,bobbles_row)"
"0","  }"
"0","  else {"
"0","    if (method == ""circular"") {"
"0","      prev_bobble = x_add[length(x_add)]"
"0","      next_bobble = bobble_freq - (nstitches - prev_bobble)"
"0","      x_add = seq(from = next_bobble, to = nstitches, by = bobble_freq)"
"0","    }"
"0","    else {"
"0","      if ((i %% 2) == 0) {"
"0","        # even rows"
"0","        prev_bobble = x_add[length(x_add)]"
"0","        next_bobble = nstitches - prev_bobble"
"0","        "
"0","        odd_dir_bobble = nstitches - (bobble_freq - next_bobble) + 1"
"0","        "
"0","        x_add = seq(from = odd_dir_bobble, to = 1, by = -1*bobble_freq)"
"0","      }"
"0","      else {"
"0","        # odd rows"
"0","        prev_bobble = x_add[length(x_add)]"
"0","        next_bobble = (bobble_freq - prev_bobble) + 1"
"0","        "
"0","        x_add = seq(from = next_bobble, to = nstitches, by = bobble_freq)"
"0","      }"
"0","    }"
"0","    bobbles_row = length(x_add)"
"0","    x = append(x, x_add)"
"0","    y_add = rep(i+nknit_start,bobbles_row)"
"0","    y = append(y,y_add)"
"0","  }"
"0","}"
"0",""
"0","# create data frame"
"0","# optional: add jitter along x-axis (i.e. stitches)"
"0","if (jitter == ""no"") {"
"0","  df = tibble(x = x,"
"0","              y = y)"
"0","} else {"
"0","  df = tibble(x = round(jitter(x, amount = jitter_amount)),"
"0","              y = y)"
"0","  # prevent values from going negative"
"0","  df = df %>% "
"0","    mutate(x = if_else(x < 1, 1, x))"
"0","}"
"0",""
"0","# compute inter-bobble timings"
"0","dft <- df %>% "
"0","  arrange(y,x) %>% "
"0","  group_by(y) %>% "
"0","  group_modify(~ add_row(.x, x = nstitches + 1)) %>% "
"0","  mutate(knit = x -1, "
"0","         diff = lag(x),"
"0","         k = if_else(is.na(diff), knit, knit-diff),"
"0","         index = paste(""ind_"", row_number(), sep ="""")) %>% "
"0","  select(-knit, -diff) %>% "
"0","  ungroup()"
"0",""
"0","# write out pattern"
"0","pat <- dft %>% "
"0","  select(-x) %>% "
"0","  pivot_wider(id_cols = y, names_from = index, values_from = k) %>% "
"0","  rowwise() %>%"
"0","  # write out pattern"
"0","  unite_(""pattern"", colnames(.)[-1]) %>%"
"0","  mutate(pattern = str_replace(pattern, regex(""^0_""), ""mb, k""),"
"0","         pattern = str_remove(pattern, ""_0""),"
"0","         pattern = str_replace_all(pattern, ""_"", "", mb, k""),"
"0","         pattern = str_remove(pattern, "", mb, kNA""),"
"0","         pattern = paste(""k"", pattern, sep = """"),"
"0","         pattern = str_replace(pattern, ""kmb"", ""mb""),"
"0","         row = paste(""Row "", y, "":"", sep = """")) %>% "
"0","  # add first and last rounds of knitting"
"0","  add_row(y = 1, row = paste(""Row 1-"", nknit_start, "":"", sep = """"), pattern = paste(""k"", nstitches, sep = """")) %>% "
"0","  add_row(y = nrows-(nknit_end-1), row = paste(""Row "",nrows-(nknit_end-1), ""-"", nrows, "":"", sep = """"), pattern = paste(""k"", nstitches, sep = """")) %>% "
"0","  arrange(y)"
